{
    "$schema": "https://json-schema.org/draft/2020-12/schema",
    "$id": "05.facturas.schema.json",
    "type": "object",
    "title": "Facturas",
    "description": "Facturas generadas por una empresa",
    "properties": {
        "empresa":{
            "type": "string",
            "description": "Nombre de la empresa"
        },
        "clientes":{
            "type": "array",
            "description": "Relación de clientes",
            "items":{
                "type": "object",
                "properties":{
                    "id":{"$ref": "#/$defs/id"},
                    "dni":{
                        "type": "string",
                        "description": "DNI del cliente"
                    },
                    "nombre":{
                        "type": "string",
                        "description": "Nombre del cliente"
                    },
                    "direccion":{
                        "type": "object",
                        "description": "Direccion del cliente",
                        "properties":{
                            "domicilio":{
                                "type": "string",
                                "description": "Domicilio del cliente (calle y nº de puerta)"
                            },
                            "cp":{
                                "type": "integer",
                                "description": "Código postal de la población del cliente",
                                "minLength": 5,
                                "maxLenght": 5
                            },
                            "poblacion":{
                                "type": "string",
                                "description": "Poblacion del cliente"
                            }
                        },
                        "additionalProperties": false,
                        "required": ["domicilio","cp","poblacion"]
                    }
                },
                "additionalProperties": false,
                "required": ["id","dni","nombre","direccion"]
            }
        },
        "facturas":{
            "type": "array",
            "description": "Facturas asociadas a los clientes",
            "items":{
                "type": "object",
                "properties": {
                    "codigo":{
                        "type": "integer",
                        "description": "Identificador único de la factura",
                        "minimum": 1
                    },
                    "cliente":{"$ref": "#/$defs/id"},
                    "fecha":{
                        "type": "string",
                        "description": "Fecha de la factura"
                    },
                    "descuento":{
                        "type": "integer",
                        "description": "Descuento a hacer en la factura"
                    },
                    "contenido": {
                        "type": "array",
                        "description": "Productos vigentes en la factura",
                        "items":{
                            "type": "object",
                            "properties": {
                                "producto":{
                                    "type": "string",
                                    "description": "Nombre del producto"
                                },
                                "precio":{
                                    "type": "number",
                                    "description": "Precio del producto",
                                    "minimum": 0
                                },
                                "cantidad":{
                                    "type": "number",
                                    "description": "Cantidad de producto que se compra",
                                    "minimum": 1
                                },
                                "iva":{
                                    "type": "string",
                                    "description": "Tipo de iva que se aplica a la compra",
                                    "enum": ["general","reducido","superreducido"]
                                }
                            },
                            "additionalProperties": false,
                            "required": ["producto","precio","cantidad","iva"]
                        }
                    }
                },
                "additionalProperties": false,
                "required": ["codigo","cliente","fecha","descuento","contenido"]
            }
        }
    },
    "additionalProperties": false,
    "required": ["empresa","clientes"],

    "$defs": {
        "id":{
            "type": "integer",
            "description": "Identificador único del cliente",
            "minimum": 1
        }
    }
}