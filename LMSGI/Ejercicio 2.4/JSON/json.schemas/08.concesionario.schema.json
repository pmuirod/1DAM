{
    "schema": "https://json-schema.org/draft/2020-12/schema",
    "$id": "07.concesionario.schema.json",
    "type": "object",
    "title": "Concesionario",
    "description": "Registro de coches de un concesionario",
    "properties": {
        "concesionario":{
            "type": "string",
            "description": "Nombre del concesionario"
        },
        "clientes":{
            "type": "array",
            "description": "Listado de clieentes del concesionario",
            "items": {
                "type": "object",
                "properties": {
                    "id":{"$ref": "#/$defs/id_cliente"},
                    "dni":{
                        "type": "string",
                        "description": "DNI del cliente",
                        "minLength": 9,
                        "maxLength": 9
                    },
                    "nombre":{
                        "type": "string",
                        "description": "Nombre del cliente"
                    },
                    "direccion":{
                        "type": "object",
                        "description": "Dirección del cliente",
                        "properties": {
                            "domicilio":{
                                "type": "string",
                                "description": "Domicilio del cliente"
                            },
                            "cp":{
                                "type": "integer",
                                "description": "Código postal del lugar de vivienda del cliente",
                                "minLength": 5,
                                "maxLength": 5
                            },
                            "poblacion":{
                                "type": "string",
                                "description": "Población donde vive el cliente"
                            }
                        },
                        "additionalProperties": false,
                        "required": ["domicilio","cp","poblacion"]
                    }
                },
                "additionalProperties": false,
                "required": ["id","dni","nombre","direccion"]
            }
        },
        "modelos": {
            "type": "array",
            "description": "Listado de modelos disponibles en el concesionario",
            "items":{
                "type": "object",
                "properties": {
                    "id":{"$ref": "#/$defs/id_modelo"},
                    "nombre":{
                        "type": "string",
                        "description": "Nombre del modelo"
                    },
                    "cilindrada":{
                        "type": "integer",
                        "description": "Cilindrada del modelo"
                    },
                    "cv":{
                        "type": "integer",
                        "description": "Caballos del modelo"
                    },
                    "velmax":{
                        "type": "integer",
                        "description": "Velocidad máxima del modelo"
                    },
                    "plazas":{
                        "type": "integer",
                        "description": "Número de plazas del modelo",
                        "minimum": 2
                    }
                },
                "additionalProperties": false,
                "required": ["id","nombre","cilindrada","cv","velmax","plazas"]
            }
        },
        "coches":{
            "type": "array",
            "description": "Coches que tiene el concesionario",
            "items":{
                "type": "object",
                "properties": {
                    "id":{
                        "type": "integer",
                        "description": "Identificador único del coche",
                        "minimum": 1
                    },
                    "modelo":{"$ref": "#/$defs/id_modelo"},
                    "tipo":{
                        "type": "string",
                        "description": "Tipo de coche (nuevo, 2mano)",
                        "enum": ["nuevo","2mano","km0"]
                    },
                    "km":{
                        "type": "integer",
                        "description": "Indica los kilometros que tiene el coche"
                    },
                    "reservado":{"$ref": "#/$defs/id_cliente"}
                },
                "additionalProperties": false,
                "required": ["id","modelo","tipo"],
                "dependentSchemas":{
                    "km":{
                        "tipo": "2mano"
                    }
                }
            }
        }
    },
    "additionalProperties": false,
    "required": ["concesionario","clientes","modelos","coches"],

    "$defs": {
        "id_modelo":{
            "type": "integer",
            "description": "Identificador único del modelo",
            "minimum": 1
        },
        "id_cliente":{
            "type": "integer",
            "description": "Idedntificador úncio del cliente",
            "minimum": 1
        }
    }
}